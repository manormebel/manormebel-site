<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Manor Mebel | Toko Mebel Jepara Furniture Berkualitas</title>
    <meta name="description" content="Manor Mebel adalah toko mebel Jepara Jawa Tengah Indonesia yang menyediakan furniture kayu berkualitas untuk rumah dan proyek, melayani lokal hingga internasional.">
    <meta name="keywords" content="toko mebel jepara, toko furniture jepara, mebel jepara jawa tengah, furniture jepara indonesia, mebel jati jepara, sofa minimalis, kursi tamu kayu jati, meja makan kayu, tempat tidur kayu, lemari pakaian, meja tv, furniture outdoor, custom furniture, jepara furniture, teak furniture indonesia, custom furniture manufacturer, indonesia furniture exporter">
    <meta name="robots" content="index, follow">
    
    <!-- Schema.org LocalBusiness JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "Manor Mebel",
      "alternateName": "Toko Mebel Jepara",
      "description": "Manor Mebel adalah toko mebel Jepara Jawa Tengah Indonesia yang menyediakan furniture kayu berkualitas untuk rumah dan proyek, melayani lokal hingga internasional.",
      "url": "https://manormebel.com/",
      "telephone": "+6281325393894",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Jl. Raya Jepara",
        "addressLocality": "Jepara",
        "addressRegion": "Jawa Tengah",
        "postalCode": "59417",
        "addressCountry": "ID"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": -6.583333,
        "longitude": 110.666667
      },
      "openingHoursSpecification": {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": [
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
          "Sunday"
        ],
        "opens": "08:00",
        "closes": "18:00"
      },
      "priceRange": "Rp",
      "paymentAccepted": "Cash, Bank Transfer, E-Wallet",
      "currenciesAccepted": "IDR",
      "hasMap": "https://maps.google.com/?q=Jepara+Jawa+Tengah+Indonesia",
      "keywords": [
        "toko mebel jepara",
        "toko furniture jepara",
        "mebel jepara jawa tengah",
        "furniture jepara indonesia",
        "mebel jati jepara",
        "sofa minimalis",
        "kursi tamu kayu jati",
        "meja makan kayu",
        "tempat tidur kayu",
        "lemari pakaian",
        "meja tv",
        "furniture outdoor",
        "custom furniture",
        "jepara furniture",
        "teak furniture indonesia",
        "custom furniture manufacturer",
        "indonesia furniture exporter"
      ],
      "sameAs": [
        "https://facebook.com/manormebel",
        "https://instagram.com/manormebel",
        "https://twitter.com/manormebel"
      ]
    }
    </script>
    
    <!-- Preconnect to CDNs -->
    <!-- Tailwind CDN removed - using local CSS -->
    <!-- Lucide CDN removed - using local JS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload Critical Images -->
    <link rel="preload" href="/images/hero/family.jpg" as="image" fetchpriority="high">
    <link rel="preload" href="/images/logo/logo.png" as="image" fetchpriority="high">
    <link rel="preload" href="/images/logo/text.png" as="image" fetchpriority="high">
    
    <!-- Preload Category Icons -->
    <link rel="preload" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M12 6v12m-3-6h6'/></svg>" as="image">
    <link rel="preload" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z'/></svg>" as="image">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="./data.js" as="script">
    <link rel="preload" href="/images/products/kursi-makan/kursi-makan-id-1/1.jpg" as="image">
    <link rel="preload" href="/images/products/sofa/sofa-id-1/1.jpg" as="image">
    <link rel="prefetch" href="./product.html">
    <link rel="prefetch" href="./cara-pemesanan.html">
    <link rel="prefetch" href="./garansi.html">
    <link rel="prefetch" href="./tentang-kami.html">
    <link rel="prefetch" href="./pengiriman.html">
    
    <!-- Local CSS Files - No CDN Dependency -->
    
    <!-- Emergency Dark Mode Logo Fix -->
    <style>
        /* Ultra-specific dark mode logo filters */
        @media (prefers-color-scheme: dark) {
            html body header img[alt*="Manor Mebel Logo"],
            html body nav img[alt*="Manor Mebel Logo"],
            html body header a img[alt*="Manor Mebel Logo"],
            html body nav a img[alt*="Manor Mebel Logo"],
            html body img.dark\:brightness-0.dark\:invert[alt*="Manor Mebel Logo"] {
                filter: brightness(0) invert(1) !important;
                -webkit-filter: brightness(0) invert(1) !important;
                -moz-filter: brightness(0) invert(1) !important;
                -ms-filter: brightness(0) invert(1) !important;
                -o-filter: brightness(0) invert(1) !important;
            }
            
            html body header img[alt*="Manor Mebel Text"],
            html body nav img[alt*="Manor Mebel Text"],
            html body header a img[alt*="Manor Mebel Text"],
            html body nav a img[alt*="Manor Mebel Text"],
            html body img.dark\:brightness-0.dark\:invert[alt*="Manor Mebel Text"] {
                filter: brightness(0) invert(1) !important;
                -webkit-filter: brightness(0) invert(1) !important;
                -moz-filter: brightness(0) invert(1) !important;
                -ms-filter: brightness(0) invert(1) !important;
                -o-filter: brightness(0) invert(1) !important;
            }
        }
    </style>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/tailwind-local.css">
    
    <!-- Cache Busting Version -->
    <script>
        // Generate version for cache busting (change this when updating files)
        window.CACHE_VERSION = 'v1.0.7';
        
        // Function to add version query to CSS and JS files
        function addCacheBusting() {
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            const scripts = document.querySelectorAll('script[src]');
            
            links.forEach(link => {
                if (link.href && !link.href.includes('?v=') && !link.href.includes('fonts.googleapis')) {
                    link.href = link.href + '?v=' + window.CACHE_VERSION;
                }
            });
            
            scripts.forEach(script => {
                if (script.src && !script.src.includes('?v=') && !script.src.includes('cdn.tailwindcss')) {
                    script.src = script.src + '?v=' + window.CACHE_VERSION;
                }
            });
        }
        
        // Apply cache busting on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', addCacheBusting);
        } else {
            addCacheBusting();
        }
    </script>
    
    <!-- Tailwind Fallback Script -->
    <script>
        // Check if Tailwind loaded successfully
        window.addEventListener('load', function() {
            if (typeof tailwind === 'undefined') {
                console.warn('Tailwind CDN failed to load, using local CSS only');
                // Add fallback classes for critical elements
                document.documentElement.classList.add('tailwind-fallback');
            }
        });
        
        // Set timeout for fallback
        setTimeout(function() {
            if (typeof tailwind === 'undefined') {
                console.warn('Tailwind CDN timeout, using local CSS');
                document.documentElement.classList.add('tailwind-fallback');
            }
        }, 3000);
    </script>
    
    <!-- Local Utilities - Load before other scripts -->
    <script src="./js/utils.js"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Google Fonts (Optional - bisa dihapus jika ingin fully local) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    
    <!-- Critical CSS for Hero Anti-Flash -->
    <style>
        /* Hero Anti-Flash Protection */
        .hero-section {
            position: relative !important;
            height: 600px !important;
            background-color: #1c1917 !important;
            overflow: hidden !important;
            contain: layout style paint !important;
            visibility: hidden !important; /* Hidden initially */
            opacity: 0 !important;
        }
        
        .hero-section.hero-ready {
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .hero-section * {
            contain: layout style paint !important;
        }
        
        .hero-section img {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            object-position: center 45% !important;
            opacity: 1 !important;
            visibility: visible !important;
            transform: none !important;
            animation: none !important;
            transition: none !important;
        }
        
        /* Force hero content visible immediately */
        .hero-content {
            position: relative !important;
            z-index: 10 !important;
            opacity: 1 !important;
            visibility: visible !important;
            transform: none !important;
            animation: none !important;
        }
        
        /* Prevent any layout shift */
        .hero-text {
            opacity: 1 !important;
            visibility: visible !important;
            transform: none !important;
            animation: none !important;
        }
        
        /* Ensure proper image loading without flash */
        .hero-section img[src*="hero"] {
            will-change: auto !important;
            backface-visibility: hidden !important;
            -webkit-backface-visibility: hidden !important;
        }
    </style>
    
    <!-- Hero Anti-Flash Control Script -->
    <script>
        // Prevent hero flash by controlling visibility
        (function() {
            // Hide hero immediately on page start
            document.documentElement.style.setProperty('--hero-visibility', 'hidden');
            
            // Function to show hero when ready
            // Global error listener for image fallbacks
            document.addEventListener('error', function(e) {
                if (e.target.dataset.error === 'fallback-image') {
                    e.target.src = '/images/logo/logo.png';
                }
            }, true);
            
            function showHero() {
                const heroSection = document.querySelector('.hero-section');
                if (heroSection) {
                    heroSection.classList.add('hero-ready');
                }
            }
            
            // Show hero after critical resources loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    showHero();
                });
            } else {
                // DOM already loaded
                showHero();
            }
            
            // Show hero when hero image loaded
            const heroImg = new Image();
            heroImg.src = '/images/hero/family.jpg';
            heroImg.onload = function() {
                setTimeout(showHero, 10);
            };
        })();
    </script>
    
    <link rel="stylesheet" href="./css/tailwind-local.css">
    <script>
        // Tailwind config removed - using local CSS instead
        // Custom colors and fonts will be defined in local CSS
    </script>
    <style>
        @keyframes wa-shake {
            0% { transform: rotate(0deg); }
            15% { transform: rotate(15deg); }
            30% { transform: rotate(-15deg); }
            45% { transform: rotate(15deg); }
            60% { transform: rotate(-15deg); }
            75% { transform: rotate(0deg); }
            100% { transform: rotate(0deg); }
        }
        .wa-shake {
            animation: none !important;
            display: inline-flex; /* Ensure it behaves correctly */
        }
        
        /* Ensure all lucide icons in the button can receive clicks */
        #mega-menu-btn svg,
        #mega-menu-btn i[data-lucide] {
            pointer-events: auto !important;
        }
        
        /* Ensure button has proper cursor */
        #mega-menu-btn {
            cursor: pointer !important;
        }
        
        /* Ensure spans and text can receive clicks */
        #mega-menu-btn span,
        #mega-menu-btn span * {
            pointer-events: auto !important;
        }
    </style>
</head>
<body class="bg-stone-100 dark:bg-stone-900 text-stone-900 dark:text-stone-100 font-sans antialiased">

    <!-- Navbar -->
    <nav class="bg-stone-100 dark:bg-stone-900 shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex-shrink-0 flex items-center">
                    <a href="./" class="flex items-center gap-0 cursor-pointer">
                        <!-- Icon MM Style -->
                        <img src="/images/logo/logo.png" alt="Manor Mebel Logo" class="h-16 w-auto object-contain brightness-0 invert" decoding="async" fetchpriority="high">
                        <!-- Text Image -->
                        <img src="/images/logo/text.png" alt="Manor Mebel Text" class="h-14 md:h-16 w-auto object-contain mt-1 -ml-8 md:-ml-10 brightness-0 invert" decoding="async" fetchpriority="high">
                    </a>
                </div>
                
                <div class="hidden md:flex space-x-8 items-center">
                    <!-- Menu items removed as requested -->
                </div>

                <div class="flex items-center space-x-4 relative">
                    <div id="search-container" class="hidden absolute right-0 top-full mt-2 w-72 bg-white dark:bg-stone-800 shadow-lg rounded-lg p-3 border border-stone-100 dark:border-stone-700 z-50" onmouseleave="hideSearchIfEmpty()">
                        <input type="text" id="search-input" placeholder="Cari furniture..." class="w-full px-4 py-2 rounded-md border border-stone-200 dark:border-stone-600 dark:bg-stone-700 dark:text-stone-100 focus:outline-none focus:border-wood-dark text-sm" onkeyup="searchProducts(this.value)">
                    </div>
                    <button id="search-toggle-btn" class="text-stone-500 hover:text-wood-dark dark:text-stone-400 dark:hover:text-wood-light transition-colors">
                        <i data-lucide="search" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <div id="about-overlay" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-stone-900/80 backdrop-blur-sm"></div>
        <div class="relative max-w-3xl mx-auto bg-stone-50 dark:bg-stone-800 rounded-lg shadow-xl text-stone-900 dark:text-stone-100 my-10 p-6 sm:p-8 overflow-y-auto max-h-[80vh]">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl sm:text-3xl font-serif font-bold">Tentang Kami</h2>
                <button class="text-stone-500 hover:text-stone-700 dark:text-stone-400 dark:hover:text-stone-200 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="space-y-4 text-base sm:text-lg leading-relaxed">
                <p>Manor Mebel adalah usaha furniture yang berlokasi di Jepara, Jawa Tengah, dan telah beroperasi secara offline sejak tahun 2001. Dengan pengalaman lebih dari dua dekade, kami tumbuh sebagai penyedia furniture yang mengutamakan kualitas, ketelitian pengerjaan, serta kepercayaan pelanggan.</p>
                <p>Jepara dikenal sebagai kota ukir dan pusat industri mebel di Indonesia. Berbekal keahlian pengrajin lokal yang berpengalaman serta pemilihan material berkualitas, Manor Mebel menghadirkan produk furniture yang kuat, fungsional, dan memiliki nilai estetika tinggi.</p>
                <p>Mengikuti perkembangan zaman, pada tahun 2025 Manor Mebel hadir secara online untuk menjangkau pelanggan di seluruh Indonesia. Melalui layanan digital, kami memberikan kemudahan dalam memilih produk, melakukan pemesanan, hingga pengiriman langsung ke lokasi pelanggan.</p>
                <p>Selain produk jadi, Manor Mebel juga melayani pembuatan furniture custom design sesuai kebutuhan, ukuran, dan konsep yang diinginkan pelanggan. Mulai dari desain klasik hingga modern, kami siap membantu mewujudkan furniture yang sesuai dengan karakter ruang Anda.</p>
                <p>Setiap produk Manor Mebel dikerjakan dengan standar kualitas tinggi dan melalui proses kontrol yang teliti untuk memastikan hasil yang maksimal. Dengan pengalaman sejak 2001 dan inovasi di era digital, Manor Mebel berkomitmen menjadi mitra terpercaya dalam menghadirkan furniture yang nyaman, tahan lama, dan bernilai jangka panjang.</p>
            </div>
        </div>
    </div>
    <div id="warranty-overlay" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-stone-900/80 backdrop-blur-sm"></div>
        <div class="relative max-w-3xl mx-auto bg-stone-50 dark:bg-stone-800 rounded-lg shadow-xl text-stone-900 dark:text-stone-100 my-10 p-6 sm:p-8 overflow-y-auto max-h-[80vh]">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl sm:text-3xl font-serif font-bold">Garansi</h2>
                <button class="text-stone-500 hover:text-stone-700 dark:text-stone-400 dark:hover:text-stone-200 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="space-y-6 text-base sm:text-lg leading-relaxed">
                <div>
                    <p class="font-semibold">Barang Rusak / Lecet saat diterima</p>
                    <ol class="mt-2 list-decimal pl-5 space-y-2">
                        <li>Klaim hanya diterima selama sopir pengantar masih di lokasi penerimaan.</li>
                        <li>Tanggung jawab penuh berada pada pihak kargo / ekspedisi.</li>
                    </ol>
                </div>
                <div>
                    <p class="font-semibold">Lecet Ringan</p>
                    <ol class="mt-2 list-decimal pl-5 space-y-2">
                        <li>Kami akan mengirim bahan finishing dengan warna yang sama melalui paket.</li>
                        <li>Pemesan dapat langsung memperbaiki lecet ringan menggunakan bahan tersebut.</li>
                    </ol>
                </div>
                <div>
                    <p class="font-semibold">Kerusakan Berat</p>
                    <ol class="mt-2 list-decimal pl-5 space-y-2">
                        <li>Untuk kerusakan berat, barang akan diretur terlebih dahulu.</li>
                        <li>Barang akan kami lakukan servis / perbaikan total sesuai prosedur.</li>
                        <li>Apabila barang tidak memungkinkan untuk diperbaiki, maka akan kami ganti dengan yang baru.</li>
                    </ol>
                </div>
                <div>
                    <p class="font-semibold">Catatan Penting</p>
                    <ol class="mt-2 list-decimal pl-5 space-y-2">
                        <li>Pastikan melakukan pengecekan saat barang diterima.</li>
                        <li>Foto kondisi barang sebelum sopir meninggalkan lokasi dapat mempercepat proses klaim.</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <div id="shipping-overlay" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-stone-900/80 backdrop-blur-sm"></div>
        <div class="relative max-w-3xl mx-auto bg-stone-50 dark:bg-stone-800 rounded-lg shadow-xl text-stone-900 dark:text-stone-100 my-10 p-6 sm:p-8 overflow-y-auto max-h-[80vh]">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl sm:text-3xl font-serif font-bold">Pengiriman</h2>
                <button class="text-stone-500 hover:text-stone-700 dark:text-stone-400 dark:hover:text-stone-200 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="text-base sm:text-lg leading-relaxed">
                <p class="font-semibold">(Pengiriman)</p>
                <ol class="mt-2 list-decimal pl-5 space-y-2">
                    <li>Pengiriman menggunakan jasa ekspedisi / kargo lokal sesuai kesepakatan bersama.</li>
                    <li>Biaya pengiriman sepenuhnya menjadi tanggung jawab pembeli.</li>
                    <li>Jadwal keberangkatan pengiriman menyesuaikan pihak ekspedisi.</li>
                    <li>Nomor kontak sopir / pihak ekspedisi akan kami informasikan untuk keperluan tracking.</li>
                    <li>Pembeli dapat memantau langsung posisi barang melalui sopir / ekspedisi.</li>
                    <li>Pastikan penerima dapat dihubungi saat barang tiba di alamat tujuan.</li>
                    <li>Segala bentuk kerusakan selama proses pengiriman menjadi tanggung jawab pihak ekspedisi sesuai ketentuan yang berlaku.</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="hero-section relative bg-stone-900 h-[600px] flex items-center">
        <div class="absolute inset-0 overflow-hidden">
            <img src="/images/hero/family.jpg" alt="Keluarga di ruang tamu dengan furnitur Manor Mebel" width="1920" height="600" class="w-full h-full object-cover object-[center_45%]">
            <!-- Gradient: Darker at bottom for text, clear at top for image -->
            <div class="absolute inset-0 bg-gradient-to-t from-stone-900/90 via-stone-900/40 to-transparent"></div>
        </div>
        <div class="hero-content relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="hero-text text-4xl tracking-tight font-extrabold text-white sm:text-5xl md:text-6xl font-serif text-center mx-auto leading-tight mb-3 md:mb-4 drop-shadow-2xl shadow-black">
                <span>Hadirkan Keindahan Di Rumah Anda</span>
            </h1>
            <p class="hero-text mt-4 text-base text-white text-center sm:text-lg max-w-none mx-auto md:mt-5 md:text-xl leading-snug drop-shadow">
                Temukan Koleksi furniture modern minimalis dengan desain sesuai ruangan Anda
            </p>

        </div>
    </div>

    <!-- Catalog Section -->
    <section id="katalog" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-24">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-serif font-bold text-stone-900 dark:text-stone-100 sm:text-4xl">Koleksi Produk</h2>
            <p class="mt-4 text-stone-500 dark:text-stone-400 max-w-2xl md:max-w-full mx-auto">
                Setiap produk dibuat dengan detail sempurna untuk melengkapi keindahan ruangan Anda
            </p>
        </div>

        <!-- Category Buttons -->
        <div class="flex flex-wrap items-center justify-center gap-2 md:gap-4 mb-6 md:mb-10 relative z-40">
            
            <!-- Semua Produk Button -->
            <button class="filter-btn px-4 py-2 md:px-6 md:py-2.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 bg-stone-50 dark:bg-stone-800 text-stone-700 dark:text-stone-300 border border-stone-200 dark:border-stone-700 hover:border-wood-medium dark:hover:border-wood-light hover:text-wood-dark dark:hover:text-wood-light shadow-sm flex-shrink-0 order-1" data-category="All">Semua Produk</button>

            <!-- Custom Furniture Button (Reordered for Mobile) -->
            <button class="filter-btn px-4 py-2 md:px-6 md:py-2.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 bg-stone-50 dark:bg-stone-800 text-stone-700 dark:text-stone-300 border border-stone-200 dark:border-stone-700 hover:border-wood-medium dark:hover:border-wood-light hover:text-wood-dark dark:hover:text-wood-light shadow-sm flex-shrink-0 order-2 md:order-3" data-category="Latest">
                Produk Terbaru
            </button>
            <button class="filter-btn px-4 py-2 md:px-6 md:py-2.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 bg-stone-50 dark:bg-stone-800 text-stone-700 dark:text-stone-300 border border-stone-200 dark:border-stone-700 hover:border-wood-medium dark:hover:border-wood-light hover:text-wood-dark dark:hover:text-wood-light shadow-sm flex-shrink-0 order-3 md:order-4" data-category="Request Design">
                Custom Furniture
            </button>

            <!-- Mega Menu Category Dropdown (Reordered for Mobile) -->
            <div class="order-4 md:order-2">
                <button id="mega-menu-btn" class="px-4 py-2 md:px-6 md:py-2.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 bg-stone-50 text-stone-700 border border-stone-200 hover:border-wood-medium hover:text-wood-dark dark:bg-stone-800 dark:text-stone-300 dark:border-stone-700 dark:hover:border-wood-light dark:hover:text-wood-light shadow-sm flex items-center gap-3 group">
                    <span id="kategori-label">Kategori Produk</span>
                    <i id="icon-x" data-lucide="x" class="w-4 h-4 hidden"></i>
                </button>
                
                <!-- Mega Menu Dropdown -->
                <div id="mega-menu" class="hidden absolute top-full left-0 right-0 mx-auto sm:left-1/2 sm:right-auto sm:transform sm:-translate-x-1/2 mt-3 w-[95vw] sm:w-[400px] md:w-[600px] h-auto max-h-[85vh] md:max-h-none rounded-xl shadow-2xl border border-stone-100 dark:border-stone-700 overflow-hidden bg-stone-50 dark:bg-stone-800 z-50 transition-all duration-200">
                    
                    <!-- Mobile Header (Close Button) - Hidden for PC-like look -->
                    <div class="hidden flex items-center justify-between p-4 border-b border-stone-100 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 sticky top-0 z-10">
                        <h3 class="font-serif font-bold text-lg text-stone-900 dark:text-stone-100">Kategori Produk</h3>
                        <button id="mega-menu-mobile-toggle" class="p-2 text-stone-500 hover:text-stone-900 dark:text-stone-400 dark:hover:text-stone-100 bg-stone-50 dark:bg-stone-800 rounded-full">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>

                    <div class="flex flex-row h-auto min-h-[350px] md:h-auto overflow-hidden">
                        <!-- Left Sidebar (Main Categories) -->
                        <div class="w-[35%] md:w-1/3 bg-stone-50 dark:bg-stone-800 border-r border-stone-100 dark:border-stone-700 overflow-y-auto" id="main-category-list">
                            <!-- Injected by JS -->
                        </div>
                        
                        <!-- Right Content (Sub Categories) -->
                        <div class="flex flex-col w-[65%] md:w-2/3 bg-stone-50 dark:bg-stone-800 h-full" data-category-description-living="Furniture ruang tamu dari Manor Mebel Jepara meliputi sofa, meja kursi tamu, lemari hias, meja TV, console table, cermin hias, dan buffet dengan material kayu berkualitas." data-category-description-dining="Koleksi furniture ruang makan seperti meja makan dan kursi makan kayu yang fungsional dan cocok untuk kebutuhan rumah maupun proyek." data-category-description-bedroom="Furniture kamar tidur meliputi tempat tidur, lemari pakaian, lemari laci, meja rias, dan nakas dengan desain rapi dan nyaman." data-category-description-office="Furniture ruang kantor Jepara seperti meja kantor, kursi direktur, lemari arsip, dan meja meeting untuk kebutuhan kerja dan proyek." data-category-description-kids="Furniture ruang anak meliputi tempat tidur anak, meja belajar, lemari anak, rak mainan, dan box bayi dengan desain fungsional." data-category-description-outdoor="Furniture teras dan outdoor seperti meja kursi teras, meja kursi taman, kursi santai, lounge chair, dan ayunan dari material kayu pilihan." data-category-description-cafe="Furniture cafe dan bar meliputi meja kursi cafe dan meja kursi bar yang cocok untuk kebutuhan komersial dan proyek." data-custom-furniture="Layanan custom furniture Jepara untuk pembuatan produk sesuai kebutuhan, ukuran, dan konsep yang diinginkan pelanggan.">
                            <div class="flex-1 overflow-y-auto p-4 md:p-6">
                                <div class="flex items-center justify-between mb-4 md:mb-6 sticky top-0 bg-white dark:bg-stone-800 z-10 py-2">
                                    <h4 id="submenu-title" class="font-serif font-bold text-base md:text-xl text-stone-800 dark:text-stone-100 leading-tight">Pilih Kategori</h4>
                                    <span class="text-[10px] md:text-xs text-stone-400 dark:text-stone-500 bg-stone-100 dark:bg-stone-700 px-2 py-1 rounded-full whitespace-nowrap">Sub Kategori</span>
                                </div>
                                <div id="submenu-grid" class="grid grid-cols-1 gap-2 md:gap-3">
                                    <!-- Injected by JS -->
                                    <div class="col-span-full text-center py-10 text-stone-400 flex flex-col items-center">
                                        <i data-lucide="mouse-pointer-click" class="w-8 h-8 mb-2 opacity-50"></i>
                                        <p class="text-xs md:text-sm">Pilih kategori utama di sebelah kiri</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 md:p-6 border-t border-stone-100 dark:border-stone-700 flex justify-end bg-stone-50 dark:bg-stone-800">
                                <button id="mega-menu-select-btn" class="px-4 py-2 md:px-8 md:py-2.5 bg-orange-500 text-white rounded-full font-medium shadow-md hover:shadow-lg hover:bg-orange-600 transition-all flex items-center gap-2 text-xs md:text-base cursor-pointer">
                                    <span>Pilih</span>
                                    <i data-lucide="check" class="w-3 h-3 md:w-4 md:h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Grid -->
        <div class="grid grid-cols-1 gap-y-10 gap-x-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8" id="product-grid" data-custom-furniture-description="Layanan custom furniture Jepara untuk pembuatan produk sesuai kebutuhan, ukuran, dan konsep yang diinginkan pelanggan.">
            <!-- Products will be injected here by JS -->
        </div>

        <!-- Pagination -->
        <div id="pagination-container" class="mt-12 flex flex-wrap justify-center gap-2">
            <!-- Pagination buttons will be injected here by JS -->
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-300">
        <div class="max-w-7xl mx-auto py-16 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12 text-center">
                <div class="flex flex-col items-center">
                    <div class="flex items-center justify-center gap-0 mb-6">
                         <img src="/images/logo/logo.png" alt="Manor Mebel Logo" class="h-16 w-auto object-contain brightness-0 invert" loading="lazy">
                         <img src="/images/logo/text.png" alt="Manor Mebel Text" class="h-14 md:h-16 w-auto object-contain mt-1 -ml-8 md:-ml-10 brightness-0 invert" loading="lazy">
                    </div>
                    <p class="text-sm text-stone-400 leading-relaxed max-w-sm" data-footer-description="Hadirkan kenyamanan dan estetika premium untuk hunian impian Anda. Desain elegan, kualitas terbaik">
                        Hadirkan kenyamanan dan estetika premium untuk hunian impian Anda. Desain elegan, kualitas terbaik
                    </p>
                </div>
                <div class="flex flex-col items-center">
                    <h3 class="text-xs font-bold text-white tracking-[0.2em] uppercase mb-6">Informasi</h3>
                    <ul class="space-y-4">
                        <li><a href="./cara-pemesanan.html" class="text-sm text-stone-400 hover:text-white transition-colors">Cara Pemesanan</a></li>
                        <li><a href="./pengiriman.html" class="text-sm text-stone-400 hover:text-white transition-colors">Pengiriman</a></li>
                        <li><a href="./garansi.html" class="text-sm text-stone-400 hover:text-white transition-colors">Garansi</a></li>
                        <li><a href="./tentang-kami.html" class="text-sm text-stone-400 hover:text-white transition-colors">Tentang Kami</a></li>
                    </ul>
                </div>
                <div class="flex flex-col items-center">
                    <h3 class="text-xs font-bold text-white tracking-[0.2em] uppercase mb-6">Hubungi Kami</h3>
                    <div class="space-y-4 flex flex-col items-center mb-4">
                        <a href="mailto:manormebeljepara@gmail.com?subject=Tanya%20Produk%20Manor%20Mebel&body=Halo%20Manor%20Mebel,%20saya%20ingin%20bertanya%20tentang%20produk..." class="flex items-center gap-3 text-sm text-stone-400 hover:text-white transition-colors group">
                            <i data-lucide="mail" class="w-4 h-4 text-stone-500 group-hover:text-white transition-colors"></i>
                            <span class="tracking-wide">manormebeljepara@gmail.com</span>
                        </a>
                        <a href="whatsapp://send?phone=6281325393894&text=Halo%20Manor%20Mebel,%20saya%20tertarik%20dengan%20produk%20Anda" target="_self" class="flex items-center gap-3 text-sm text-stone-400 hover:text-white transition-colors group">
                            <i data-lucide="message-circle" class="w-4 h-4 text-stone-500 group-hover:text-white transition-colors"></i>
                            <span class="tracking-wide">+62 813-2539-3894</span>
                        </a>
                    </div>
                    <p class="text-sm mb-2 text-stone-400">Jepara, Jawa Tengah</p>
                    <p class="text-sm mb-4 text-stone-400">Indonesia</p>
                </div>
            </div>
            
            <div class="mt-16 pt-8 border-t border-stone-800 flex flex-col items-center">
                <p class="text-xs font-bold text-white tracking-[0.2em] uppercase mb-6">Sosial Media</p>
                <div class="flex justify-center space-x-8 mb-6">
                    <a href="https://www.instagram.com/manormebel/" aria-label="Instagram" class="text-stone-500 hover:text-white transition-colors" target="_blank" rel="noopener">
                        <i data-lucide="instagram" class="w-5 h-5"></i>
                    </a>
                    <a href="https://www.facebook.com/profile.php?id=61585164303421" aria-label="Facebook" class="text-stone-500 hover:text-white transition-colors" target="_blank" rel="noopener">
                        <i data-lucide="facebook" class="w-5 h-5"></i>
                    </a>
                    <a href="https://x.com/Manormebel" aria-label="Twitter" class="text-stone-500 hover:text-white transition-colors" target="_blank" rel="noopener">
                        <i data-lucide="twitter" class="w-5 h-5"></i>
                    </a>
                    <a href="https://www.tiktok.com/@manormebel" aria-label="TikTok" class="text-stone-500 hover:text-white transition-colors" target="_blank" rel="noopener">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5c0 2.5-2 2.5-2 2.5"></path>
                        </svg>
                    </a>
                </div>
                <p class="text-xs text-stone-500 tracking-wide">&copy;2026 Manor Mebel. All rights reserved.</p>
                <p class="text-xs text-stone-400 mt-4 max-w-2xl mx-auto leading-relaxed" data-footer-description-id="Toko mebel Jepara Jawa Tengah Indonesia yang menyediakan furniture kayu jati berkualitas dengan harga termurah. Produk meliputi sofa, kursi tamu, meja makan, tempat tidur, lemari, meja TV, furniture outdoor, dan custom furniture. Melayani Jepara, seluruh Indonesia, hingga pasar internasional dan ekspor furniture.">
                    Toko mebel Jepara Jawa Tengah Indonesia yang menyediakan furniture kayu jati berkualitas dengan harga termurah. Produk meliputi sofa, kursi tamu, meja makan, tempat tidur, lemari, meja TV, furniture outdoor, dan custom furniture. Melayani Jepara, seluruh Indonesia, hingga pasar internasional dan ekspor furniture.
                </p>
                <p class="text-xs text-stone-400 mt-2 max-w-2xl mx-auto leading-relaxed" data-footer-description-en="We are a Jepara furniture manufacturer from Indonesia, providing quality teak wood furniture, custom furniture, and export services for international markets.">
                    We are a Jepara furniture manufacturer from Indonesia, providing quality teak wood furniture, custom furniture, and export services for international markets.
                </p>
            </div>
        </div>
    </footer>

    <!-- Local scripts - No CDN dependency -->
    <script src="./data.js"></script>
    <script>
        // Data Products loaded from data.js

        // Initialize Icons
        lucide.createIcons();

        // Share Product Function
        async function shareProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const imageUrl = encodeURI(product.image);
            const message = `Halo Manor Mebel, saya tertarik dengan produk ini:\n\nNama: ${product.name}`;
            const waText = encodeURIComponent(message + '\nLink Gambar: ' + imageUrl);
            const waDeep = `whatsapp://send?phone=6281325393894&text=${waText}`;
            const waWeb = `https://wa.me/6281325393894?text=${waText}`;

            try {
                // Try Web Share API with File
                if (navigator.share) {
                    const response = await fetch(imageUrl);
                    const blob = await response.blob();
                    const file = new File([blob], `${product.name.replace(/[^a-zA-Z0-9]/g, '_')}.jpg`, { type: blob.type });

                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            files: [file],
                            text: message
                        });
                        return; // Success, stop here
                    }
                }
            } catch (error) {
                console.log("Share API skipped or failed, falling back to link:", error);
            }

            window.location.href = waDeep;
            setTimeout(() => {
                window.location.href = waWeb;
            }, 600);
        }

        // Helper to create product card
        function createProductCard(product, index) {
            // Placeholder logic if image is missing
            const safeSrc = product.image ? product.image : '';
            const imageHtml = product.image 
                ? `<img src="${safeSrc}" alt="${product.name} kayu untuk ${product.category} Manor Mebel Jepara" loading="lazy" decoding="async" class="product-img h-full w-full object-cover object-center" data-error="fallback-image" width="400" height="300">`
                : `<div class="h-full w-full flex items-center justify-center bg-stone-100 dark:bg-stone-700 text-stone-300 dark:text-stone-500">
                     <i data-lucide="image" class="w-12 h-12"></i>
                   </div>`;

            return `
                <div class="product-card group relative bg-stone-50 dark:bg-stone-800 border border-stone-100 dark:border-stone-700 hover:shadow-xl transition-all duration-200 overflow-hidden flex flex-col h-full rounded-xl">
                    <div class="aspect-w-1 aspect-h-1 w-full overflow-hidden bg-stone-200 dark:bg-stone-700 h-72 sm:h-80 relative">
                        ${imageHtml}
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-5 transition-opacity pointer-events-none"></div>
                        
                        <!-- Main Link Overlay (Covers Image) -->
                        <a href="./product.html?id=${product.id}" class="absolute inset-0 z-10" aria-label="Lihat Detail Produk ${product.name}"></a>
                    </div>
                    <div class="p-5 relative text-center bg-stone-700 group-hover:bg-stone-600 dark:bg-stone-700 dark:group-hover:bg-stone-600 transition-colors duration-200 flex-1 flex flex-col justify-center items-center">
                        <div class="w-full flex flex-col items-center justify-center gap-2">
                            <a href="./product.html?id=${product.id}" class="block w-full">
                                <h3 class="text-lg font-serif font-bold text-white dark:text-stone-100 hover:text-white dark:hover:text-wood-light transition-colors leading-snug line-clamp-2 overflow-hidden px-1">${product.name}</h3>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        // Pagination and Category State Management
        let storedCategory = sessionStorage.getItem('currentCategory');
        let storedPage = parseInt(sessionStorage.getItem('currentPage')) || 1;
        
        let currentCategory = 'All';
        let currentPage = 1;
        let forceScrollToCatalog = false;

        if (storedCategory) {
            // If the stored category is one of the main tabs, persist it
            if (['All', 'Latest', 'Request Design'].includes(storedCategory)) {
                currentCategory = storedCategory;
                currentPage = storedPage;
            } else {
                // If it was a Mega Menu specific category (e.g. Sofa, Meja), persist it too!
                currentCategory = storedCategory;
                currentPage = storedPage;
                forceScrollToCatalog = true;
            }
        } else {
            // Default initialization
            currentCategory = 'All';
            currentPage = 1;
        }

        const itemsPerPage = 16;

        // Render Products with Pagination
        function renderProducts(category) {
            // Update global category if provided
            if (category) {
                currentCategory = category;
            } else {
                category = currentCategory;
            }

            // Save Category State
            sessionStorage.setItem('currentCategory', currentCategory);

            const grid = document.getElementById('product-grid');
            
            let filtered;
            if (category === 'All') {
                filtered = [...products];
                // Urut berdasarkan panjang nama (panjang duluan)
                filtered.sort((a, b) => b.name.length - a.name.length);
            } else if (category === 'Latest') {
                filtered = products
                    .filter(p => p.image || (p.images && p.images.length > 0))
                    .reverse();
            } else if (category === 'Request Design') {
                filtered = products.filter(p => p.category === 'Request Design');
            } else {
                // Untuk mega menu, hanya filter berdasarkan keywords (subkategori)
                // Tidak termasuk p.category === category untuk menghindari produk yang tidak sesuai
                filtered = products.filter(p =>
                    (p.keywords && p.keywords.includes(category))
                );
            }

            // Pagination Logic
            const totalItems = filtered.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            // Validate currentPage
            if (currentPage > totalPages && totalPages > 0) currentPage = totalPages;
            if (currentPage < 1) currentPage = 1;

            // Save Page State
            sessionStorage.setItem('currentPage', currentPage);

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = filtered.slice(startIndex, endIndex);
            
            // Use safe DOM manipulation instead of innerHTML
            grid.innerHTML = ''; // Clear existing content
            
            // Add hidden custom furniture description for SEO only (Google can read, users cannot see)
            if (currentCategory === 'Request Design') {
                // Add data attribute to the grid container for SEO
                grid.setAttribute('data-custom-furniture-description', 'Layanan custom furniture Jepara untuk pembuatan produk sesuai kebutuhan, ukuran, dan konsep yang diinginkan pelanggan. Kami menerima pesanan furniture custom untuk rumah, kantor, cafe, dan proyek komersial.');
            }
            
            paginatedItems.forEach((product, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'product-card';
                DOMUtils.safeSetHTML(cardElement, createProductCard(product, index));
                grid.appendChild(cardElement);
            });
            
            // Render Pagination Controls
            renderPagination(totalPages);
            
            lucide.createIcons();
            console.log('=== updateKategoriLabel END ===');
        }

        function renderPagination(totalPages) {
            const container = document.getElementById('pagination-container');
            if (!container) return;
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '';
            
            // Previous Button
            html += `
                <button 
                    data-page="${currentPage - 1}"
                    class="pagination-btn px-3 py-2 rounded-lg border flex items-center justify-center transition-colors ${currentPage === 1 ? 'bg-stone-100 dark:bg-stone-800 text-stone-400 dark:text-stone-600 cursor-not-allowed border-stone-200 dark:border-stone-700' : 'bg-sky-100 dark:bg-sky-900 text-sky-900 dark:text-sky-100 hover:bg-sky-200 dark:hover:bg-sky-800 border-sky-200 dark:border-sky-700'}"
                    ${currentPage === 1 ? 'disabled' : ''}
                    aria-label="Previous Page"
                >
                    <i data-lucide="chevron-left" class="w-5 h-5"></i>
                </button>
            `;

            // Page Numbers
            for (let i = 1; i <= totalPages; i++) {
                html += `
                    <button 
                        data-page="${i}"
                        class="pagination-btn w-10 h-10 rounded-lg border font-medium transition-colors flex items-center justify-center ${i === currentPage ? 'bg-sky-600 text-white border-sky-600' : 'bg-sky-100 dark:bg-sky-900 text-sky-900 dark:text-sky-100 hover:bg-sky-200 dark:hover:bg-sky-800 border-sky-200 dark:border-sky-700'}"
                    >
                        ${i}
                    </button>
                `;
            }

            // Next Button
            html += `
                <button 
                    data-page="${currentPage + 1}"
                    class="pagination-btn px-3 py-2 rounded-lg border flex items-center justify-center transition-colors ${currentPage === totalPages ? 'bg-stone-100 dark:bg-stone-800 text-stone-400 dark:text-stone-600 cursor-not-allowed border-stone-200 dark:border-stone-700' : 'bg-sky-100 dark:bg-sky-900 text-sky-900 dark:text-sky-100 hover:bg-sky-200 dark:hover:bg-sky-800 border-sky-200 dark:border-sky-700'}"
                    ${currentPage === totalPages ? 'disabled' : ''}
                    aria-label="Next Page"
                >
                    <i data-lucide="chevron-right" class="w-5 h-5"></i>
                </button>
            `;

            // Use safe DOM manipulation for pagination
            DOMUtils.safeSetHTML(container, html);
            lucide.createIcons({ root: container });
            
            // Add event delegation for pagination buttons
            DOMUtils.delegateEvent(container, '.pagination-btn', 'click', function(e) {
                const page = parseInt(this.getAttribute('data-page'));
                if (!isNaN(page) && page >= 1) {
                    changePage(page);
                }
            });
        }

        function changePage(newPage) {
            currentPage = newPage;
            renderProducts(); // Use currentCategory
            // Removed auto-scroll to catalog section
        }

        // Category Data for Mega Menu
        const megaMenuCategories = [
            {
                id: 'living',
                name: 'Ruang Tamu',
                icon: 'armchair',
                subcategories: [
                    { name: 'Sofa', value: 'Sofa' },
                    { name: 'Meja kursi tamu', value: 'Meja kursi tamu' },
                    { name: 'Lemari hias', value: 'Lemari hias' },
                    { name: 'Meja TV', value: 'Meja TV' },
                    { name: 'Console Table/Cermin Hias', value: 'Console Table/Cermin Hias' },
                    { name: 'Buffet / credenza', value: 'Buffet / credenza' }
                ]
            },
            {
                id: 'dining',
                name: 'Ruang Makan',
                icon: 'utensils',
                subcategories: [
                    { name: 'Meja makan', value: 'Meja makan' },
                    { name: 'Kursi makan', value: 'Kursi makan' },
                    { name: 'Meja kursi makan', value: 'Meja kursi makan' }
                ]
            },
            {
                id: 'bedroom',
                name: 'Kamar Tidur',
                icon: 'bed',
                subcategories: [
                    { name: 'Tempat tidur', value: 'Tempat tidur' },
                    { name: 'Lemari pakaian', value: 'Lemari pakaian' },
                    { name: 'Lemari laci', value: 'Lemari laci' },
                    { name: 'Meja rias', value: 'Meja rias' },
                    { name: 'Nakas', value: 'Nakas' }
                ]
            },
            {
                id: 'office',
                name: 'Ruang Kantor',
                icon: 'briefcase',
                subcategories: [
                    { name: 'Meja kantor', value: 'Meja kantor' },
                    { name: 'Kursi direktur', value: 'Kursi direktur' },
                    { name: 'Lemari arsip', value: 'Lemari arsip' },
                    { name: 'Meja meeting', value: 'Meja meeting' }
                ]
            },
            {
                id: 'kids',
                name: 'Ruang Anak',
                icon: 'baby',
                subcategories: [
                    { name: 'Tempat tidur anak', value: 'Tempat tidur anak' },
                    { name: 'Meja kursi belajar', value: 'Meja kursi belajar' },
                    { name: 'Lemari anak', value: 'Lemari anak' },
                    { name: 'Rak mainan', value: 'Rak mainan' },
                    { name: 'Box bayi', value: 'Box bayi' }
                ]
            },
            {
                id: 'outdoor',
                name: 'Teras & Outdoor',
                icon: 'sun',
                subcategories: [
                    { name: 'Meja kursi teras', value: 'meja kursi teras' },
                    { name: 'Meja kursi taman', value: 'meja kursi taman' },
                    { name: 'Kursi santai / lounge chair', value: 'Kursi santai / lounge chair' },
                    { name: 'Ayunan', value: 'Ayunan' }
                ]
            },
            {
                id: 'cafe',
                name: 'Cafe & Bar',
                icon: 'coffee',
                subcategories: [
                    { name: 'Meja kursi bar', value: 'Meja kursi bar' },
                    { name: 'Meja kursi cafe', value: 'Meja kursi cafe' }
                ]
            }
        ];

        let activeMainCategory = null;
        let tempSelectedCategory = null;
        let isMegaMenuRendered = false;
        let isCategoryLocked = false;

        // Global Helper for Button Styles
        function setButtonActive(btn, isActive, isMega = false) {
            if (!btn) return;
            
            if (isActive) {
                // Active: Orange background, White text for orange theme, No hover conflicts
                btn.classList.remove('bg-stone-50', 'text-stone-700', 'border', 'border-stone-200', 'hover:border-wood-medium', 'hover:text-wood-dark', 'dark:bg-stone-800', 'dark:text-stone-300', 'dark:border-stone-700', 'dark:hover:border-wood-light', 'dark:hover:text-wood-light');
                btn.classList.add('bg-orange-500', 'text-white', 'shadow-md');
                
                if (isMega) {
                     const icon = btn.querySelector('i[data-lucide="layout-grid"]');
                     if(icon) icon.classList.replace('text-wood-medium', 'text-white');
                }
            } else {
                // Inactive: White background, Dark text, Hover effects enabled
                btn.classList.remove('bg-wood-dark', 'text-white', 'shadow-md', 'border-orange-500', 'text-orange-600', 'ring-2', 'ring-orange-100');
                btn.classList.add('bg-stone-50', 'text-stone-700', 'border', 'border-stone-200', 'hover:border-wood-medium', 'hover:text-wood-dark', 'dark:bg-stone-800', 'dark:text-stone-300', 'dark:border-stone-700', 'dark:hover:border-wood-light', 'dark:hover:text-wood-light');
                
                if (isMega) {
                     const icon = btn.querySelector('i[data-lucide="layout-grid"]');
                     if(icon) icon.classList.replace('text-white', 'text-wood-medium');
                }
            }
        }

        function updateSelectButtonState() {
            const btn = document.getElementById('mega-menu-select-btn');
            if (btn) {
                if (tempSelectedCategory) {
                    btn.classList.remove('opacity-50', 'cursor-not-allowed', 'shadow-none');
                    btn.classList.add('shadow-md', 'hover:shadow-lg', 'hover:bg-orange-600', 'cursor-pointer');
                } else {
                    btn.classList.add('opacity-50', 'cursor-not-allowed', 'shadow-none');
                    btn.classList.remove('shadow-md', 'hover:shadow-lg', 'hover:bg-orange-600', 'cursor-pointer');
                }
            }
        }

        function toggleMegaMenu(e) {
            console.log(' toggleMegaMenu called with event:', e);
            console.log(' Event target:', e.target);
            console.log(' Event target class:', e.target.className);
            
            // Check if the click originated from the reset icon wrapper
            if (e && e.target && e.target.closest('.js-reset-mega-menu')) {
                console.log(' X icon detected in toggleMegaMenu - triggering reset!');
                e.preventDefault();
                e.stopPropagation();
                resetMegaMenu();
                return;
            }

            const menu = document.getElementById('mega-menu');
            const isHidden = menu.classList.contains('hidden');
            const megaBtn = document.getElementById('mega-menu-btn');
            const allBtn = document.querySelector('button[data-category="All"]');
            const latestBtn = document.querySelector('button[data-category="Latest"]');
            const customBtn = document.querySelector('button[data-category="Request Design"]');
            
            if (isHidden) {
                menu.classList.remove('hidden');
                
                // Visual Update: Activate Mega Menu Button, Deactivate Others
                setSingleActiveButton(megaBtn, 'mega');

                tempSelectedCategory = null; // Reset selection
                updateSelectButtonState(); // Update select button
                isCategoryLocked = false; // Reset lock state
                
                // UPDATE CHEVRON TO UP STATE
                updateKategoriButton('open', 'Kategori Produk');
                
                if (!isMegaMenuRendered) {
                    renderMegaMenuStructure();
                    isMegaMenuRendered = true;
                }
                
                if (!activeMainCategory) {
                    updateCategoryView(megaMenuCategories[0].id);
                } else {
                    updateCategoryView(activeMainCategory);
                }
            } else {
                menu.classList.add('hidden');
                
                // UPDATE CHEVRON TO DOWN STATE (menu closed)
                const btnText = megaBtn.querySelector('span').textContent.trim();
                if (btnText === 'Kategori Produk') {
                    updateKategoriButton('default', 'Kategori Produk');
                }
            }
        }

        function renderMegaMenuStructure() {
            const leftList = document.getElementById('main-category-list');
            
            // Use safe DOM manipulation
            leftList.innerHTML = '';
            
            megaMenuCategories.forEach(cat => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                
                const button = document.createElement('button');
                button.className = `category-btn w-full px-2 py-3 md:px-6 md:py-4 flex flex-col md:flex-row items-center md:items-center gap-1 md:gap-3 transition-colors border-b border-stone-100 dark:border-stone-700 text-stone-600 dark:text-stone-300 hover:bg-stone-100 dark:hover:bg-stone-700 justify-center md:justify-start`;
                button.id = `btn-${cat.id}`;
                DOMUtils.safeSetHTML(button, `
                    <i data-lucide="${cat.icon}" class="w-5 h-5 md:w-5 md:h-5 mb-1 md:mb-0"></i>
                    <span class="font-medium text-[10px] md:text-sm lg:text-base text-center md:text-left leading-tight w-full md:w-auto">${cat.name}</span>
                    
                    <div class="ml-auto hidden md:flex items-center gap-2">
                        <i data-lucide="chevron-right" class="w-4 h-4 arrow-icon"></i>
                    </div>
                `);
                
                // Use event delegation instead of inline onclick
                button.addEventListener('click', () => handleCategoryClick(cat.id));
                button.addEventListener('mouseenter', () => handleCategoryHover(cat.id));
                
                categoryItem.appendChild(button);
                leftList.appendChild(categoryItem);
            });
            
            lucide.createIcons();
        }

        function handleCategoryHover(id) {
            if (window.innerWidth >= 768 && !isCategoryLocked) {
                updateCategoryView(id);
            }
        }

        function handleCategoryClick(id) {
            // Reset selection when clicking main category
            tempSelectedCategory = null;
            updateSelectButtonState(); // Update select button

            // Reset UI for all subcategory buttons
            const allBtns = document.querySelectorAll('.subcategory-btn');
            allBtns.forEach(b => {
                b.classList.remove('border-orange-500', 'bg-orange-50', 'text-orange-600', 'dark:text-orange-400', 'dark:bg-stone-700');
                b.classList.add('border-stone-100', 'text-stone-600', 'dark:border-stone-700', 'dark:text-stone-300');
                
                const icon = b.querySelector('.sub-check-icon');
                if(icon) icon.classList.add('hidden');
            });

            isCategoryLocked = true;
            updateCategoryView(id);
        }

        function updateCategoryView(id) {
            activeMainCategory = id;

            // Update Left Sidebar Buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.className = 'category-btn w-full px-2 py-3 md:px-6 md:py-4 flex flex-col md:flex-row items-center md:items-center gap-1 md:gap-3 transition-colors border-b border-stone-100 dark:border-stone-700 text-stone-600 dark:text-stone-300 hover:bg-stone-100 dark:hover:bg-stone-700 justify-center md:justify-start';
            });
            const activeBtn = document.getElementById(`btn-${id}`);
            if (activeBtn) {
                activeBtn.className = 'category-btn w-full px-2 py-3 md:px-6 md:py-4 flex flex-col md:flex-row items-center md:items-center gap-1 md:gap-3 transition-colors border-b border-stone-100 dark:border-stone-700 bg-orange-500 text-white justify-center md:justify-start';
            }

            // Update Right Content (Used for both Mobile and Desktop now)
            const category = megaMenuCategories.find(c => c.id === id);
            const subTitle = document.getElementById('submenu-title');
            const subGrid = document.getElementById('submenu-grid');
            
            subTitle.textContent = category.name;
            // Use safe DOM manipulation for submenu
            subGrid.innerHTML = '';
            
            // Add hidden category description for SEO only - Google can read but users cannot see
            const categoryDescriptions = {
                'living': 'Furniture ruang tamu dari Manor Mebel Jepara meliputi sofa, meja kursi tamu, lemari hias, meja TV, console table, cermin hias, dan buffet credenza dengan material kayu berkualitas.',
                'dining': 'Koleksi furniture ruang makan seperti meja makan dan kursi makan kayu yang fungsional dan cocok untuk kebutuhan rumah maupun proyek.',
                'bedroom': 'Furniture kamar tidur meliputi tempat tidur, lemari pakaian, lemari laci, meja rias, dan nakas dengan desain rapi dan nyaman.',
                'office': 'Furniture ruang kantor Jepara seperti meja kantor, kursi direktur, lemari arsip, dan meja meeting untuk kebutuhan kerja dan proyek.',
                'kids': 'Furniture ruang anak meliputi tempat tidur anak, meja belajar, lemari anak, rak mainan, dan box bayi dengan desain fungsional.',
                'outdoor': 'Furniture teras dan outdoor seperti meja kursi teras, meja kursi taman, kursi santai, lounge chair, dan ayunan dari material kayu pilihan.',
                'cafe': 'Furniture cafe dan bar meliputi meja kursi cafe dan meja kursi bar yang cocok untuk kebutuhan komersial dan proyek.'
            };
            
            if (categoryDescriptions[id]) {
                // Add as data attribute to the submenu title (Google can read data attributes, users won't see)
                subTitle.setAttribute('data-category-description', categoryDescriptions[id]);
                
                // Also add to the main category list container for additional SEO value
                const mainCategoryList = document.getElementById('main-category-list');
                if (mainCategoryList) {
                    mainCategoryList.setAttribute('data-active-category-description', categoryDescriptions[id]);
                }
            }
            
            category.subcategories.forEach(sub => {
                const isSelected = tempSelectedCategory && tempSelectedCategory.label === sub.name;
                
                const button = document.createElement('button');
                button.className = `subcategory-btn text-left p-2 md:p-3 rounded-lg border transition-all group flex items-center justify-between shadow-sm w-full ${isSelected ? 'border-orange-500 bg-orange-50 dark:bg-stone-700 text-orange-600 dark:text-orange-400' : 'border-stone-100 dark:border-stone-700 text-stone-600 dark:text-stone-300 hover:border-orange-500 hover:text-orange-600 hover:bg-orange-50 dark:hover:bg-stone-700'}`;
                button.setAttribute('data-sub-name', sub.name);
                DOMUtils.safeSetHTML(button, `
                    <span class="font-medium text-xs md:text-sm">${sub.name}</span>
                    <i data-lucide="check-circle" class="w-3 h-3 md:w-4 md:h-4 text-emerald-500 sub-check-icon ${isSelected ? '' : 'hidden'}"></i>
                `);
                
                // Use event delegation instead of inline onclick
                button.addEventListener('click', () => selectSubCategory(sub.value, sub.name, button));
                
                subGrid.appendChild(button);
            });
            
            lucide.createIcons({
                root: subGrid
            });
        }

        function selectSubCategory(value, label, btn) {
            console.log('=== selectSubCategory START ===');
            console.log('value:', value, 'label:', label);
            tempSelectedCategory = { value, label };
            
            // SAVE STATE TO localStorage - CRITICAL FOR REFRESH CONSISTENCY
            localStorage.setItem('selectedSubCategory', JSON.stringify({ value, label }));
            
            updateSelectButtonState(); // Update select button
            
            // Use unified render function for consistent UI
            console.log('Calling renderActiveCategory with:', label);
            updateKategoriButton('selected', label);
            console.log('=== selectSubCategory END ===');
            console.log('selectSubCategory called with label:', label); // Debug log
            
            // Sync all buttons with same name (both mobile and desktop)
            const allBtns = document.querySelectorAll('.subcategory-btn');
            allBtns.forEach(b => {
                const subName = b.getAttribute('data-sub-name');
                const isMatch = subName === label;

                if (isMatch) {
                    b.classList.remove('border-stone-100', 'border-stone-200', 'bg-white', 'text-stone-600', 'dark:border-stone-700', 'dark:text-stone-300');
                    b.classList.add('border-orange-500', 'bg-orange-50', 'text-orange-600', 'dark:text-orange-400', 'dark:bg-stone-700');
                    
                    const icon = b.querySelector('.sub-check-icon');
                    if(icon) icon.classList.remove('hidden');
                } else {
                    b.classList.remove('border-orange-500', 'bg-orange-50', 'text-orange-600', 'dark:text-orange-400', 'dark:bg-stone-700');
                    b.classList.add('border-stone-100', 'text-stone-600', 'dark:border-stone-700', 'dark:text-stone-300');
                    // Reset mobile specific bg if needed, or generic
                    if(b.closest('.mobile-accordion')) {
                         b.classList.add('bg-white', 'border-stone-200');
                    }
                    
                    const icon = b.querySelector('.sub-check-icon');
                    if(icon) icon.classList.add('hidden');
                }
            });
        }

        function resetMegaMenu() {
            console.log(' resetMegaMenu() called');
            // CLEAR SAVED STATE FROM localStorage
            localStorage.removeItem('selectedSubCategory');
            
            // Reset Internal State
            tempSelectedCategory = null;
            activeMainCategory = null; 
            isCategoryLocked = false;

            // Reset to "All" products
            filterProducts('All');
            
            // Use unified render function to reset to default state (handles X icon removal automatically)
            updateKategoriButton('default', 'Kategori Produk');
            
            // Re-render Mega Menu structure to clear selection highlights inside the menu
            renderMegaMenuStructure();
            // Reset view to first category
            updateCategoryView(megaMenuCategories[0].id);

            lucide.createIcons();
        }

        function getSubcategoryLabel(value) {
            // Mapping value  label dari megaMenuCategories
            for (const category of megaMenuCategories) {
                const subcategory = category.subcategories.find(sub => sub.value === value);
                if (subcategory) {
                    return subcategory.name;
                }
            }
            return value; // Fallback ke value asli jika tidak ditemukan
        }

        // FUNGSI UTAMA - SATU-SATUNYA YANG MENGATUR BUTTON
        function updateKategoriButton(state, label) {
            const megaBtn = document.getElementById('mega-menu-btn');
            if (!megaBtn) return;
            
            // DAPATKAN ELEMEN SESUAI STRUKTUR WAJIB
            const kategoriLabel = megaBtn.querySelector('#kategori-label');
            const iconX = megaBtn.querySelector('#icon-x');
            
            if (!kategoriLabel || !iconX) return;
            
            if (state === 'selected') {
                // SELECTED: Tampilkan TEXT + X
                kategoriLabel.textContent = label;
                iconX.classList.remove('hidden');
            } else {
                // DEFAULT: Tampilkan "Kategori Produk", X hidden
                kategoriLabel.textContent = 'Kategori Produk';
                iconX.classList.add('hidden');
            }
            
            lucide.createIcons();
        }

        // SINGLE RENDER FUNCTION - UNIFIED FOR CLICK AND REFRESH
        function renderActiveCategory(label) {
            updateKategoriButton(label === 'Kategori Produk' ? 'default' : 'selected', label);
        }
        
        // Legacy wrapper for backward compatibility - will be removed
        function updateKategoriLabel(label) {
            renderActiveCategory(label);
        }

        function applyMegaMenuSelection() {
            if (tempSelectedCategory) {
                console.log('=== applyMegaMenuSelection START ===');
                console.log('tempSelectedCategory:', tempSelectedCategory);
                
                console.log('About to call renderActiveCategory with:', tempSelectedCategory.label);
                // Use unified render function for consistent UI
                updateKategoriButton('selected', tempSelectedCategory.label);
                
                filterProducts(tempSelectedCategory.value);
                
                // Menu is handled by updateKategoriLabel - just close the dropdown
                document.getElementById('mega-menu').classList.add('hidden');
            } else {
                // If no selection, DO NOT close the menu. 
                // Just do nothing so the user realizes they need to select a subcategory.
                // document.getElementById('mega-menu').classList.add('hidden');
            }
        }

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('mega-menu');
            const btn = document.getElementById('mega-menu-btn');
            const allBtn = document.querySelector('button[data-category="All"]');

            if (menu && !menu.classList.contains('hidden') && !menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
                
                // Revert visual state if closed without selection
                const btnText = btn.querySelector('span').textContent.trim();
                if (btnText === 'Kategori Produk') {
                    setButtonActive(btn, false, true);
                    
                    if (allBtn) {
                        setButtonActive(allBtn, true);
                    }
                }
            }
        });

        // SINGLE SOURCE OF TRUTH - ACTIVE STATE LOCK
        let activeFilterState = {
            currentCategory: 'All',
            isLocked: false,
            isInitializing: true
        };

        // STATE GLOBAL UNTUK FILTER - ANTI CONFLICT
        // Cek apakah ada subkategori tersimpan, jika ya set ke 'mega'
        const savedSubCategory = localStorage.getItem('selectedSubCategory');
        let ACTIVE_FILTER = localStorage.getItem('activeFilterCategory') || 
                           (savedSubCategory ? 'mega' : 'All');

        // FUNGSI RESET GLOBAL - HAPUS SEMUA ACTIVE CLASS
        function clearAllActiveStates() {
            const allFilterButtons = [
                document.querySelector('button[data-category="All"]'),
                document.querySelector('button[data-category="Request Design"]'),
                document.querySelector('button[data-category="Latest"]'),
                document.getElementById('mega-menu-btn')
            ];
            
            allFilterButtons.forEach(btn => {
                if (btn) {
                    setButtonActive(btn, false, btn.id === 'mega-menu-btn');
                }
            });
        }

        // Helper untuk mendapatkan tombol aktif saat ini
        function getActiveButton() {
            const buttons = [
                { btn: document.querySelector('button[data-category="All"]'), category: 'All' },
                { btn: document.querySelector('button[data-category="Request Design"]'), category: 'Request Design' },
                { btn: document.querySelector('button[data-category="Latest"]'), category: 'Latest' },
                { btn: document.getElementById('mega-menu-btn'), category: 'mega' }
            ];
            
            for (const {btn, category} of buttons) {
                if (btn && btn.classList.contains('bg-wood-dark')) {
                    return {btn, category};
                }
            }
            return null;
        }

        // FUNGSI TUNGGAL UNTUK ATUR ACTIVE BUTTON - ANTI MULTIPLE ACTIVE
        function setSingleActiveButton(targetBtn, targetCategory) {
            // 1. RESET SEMUA FILTER BUTTONS - HAPUS ACTIVE CLASS
            clearAllActiveStates();
            
            // 2. AKTIFKAN HANYA TARGET BUTTON
            if (targetBtn) {
                setButtonActive(targetBtn, true, targetCategory === 'mega');
            }
            
            // 3. UPDATE STATE GLOBAL
            ACTIVE_FILTER = targetCategory;
            localStorage.setItem('activeFilterCategory', targetCategory);
            activeFilterState.currentCategory = targetCategory;
            activeFilterState.isLocked = true;
        }

        // LOCK STATE - hanya 1 tombol boleh aktif (DEPRECATED - GUNAKAN setSingleActiveButton)
        function lockActiveState(targetCategory, targetBtn) {
            setSingleActiveButton(targetBtn, targetCategory);
        }

        // FILTER PRODUCTS - FINAL VERSION (ANTI-RESET)
        function filterProducts(category) {
            // SKIP jika masih inisialisasi atau state terkunci
            if (activeFilterState.isInitializing) {
                console.log('Skipping filterProducts during initialization');
                return;
            }
            
            // RESET SUBCATEGORY STATE when clicking top-level buttons (All, Latest, Request Design)
            if (category === 'All' || category === 'Latest' || category === 'Request Design') {
                console.log(' RESET: Clearing subcategory state for top-level button');
                
                // 1. Clear active subcategory state
                tempSelectedCategory = null;
                localStorage.removeItem('selectedSubCategory');
                
                // 2. Reset UI to default (Kategori Produk)
                updateKategoriButton('default', 'Kategori Produk');
                
                // 3. Clear any active subcategory highlights in mega menu
                document.querySelectorAll('.subcategory-btn').forEach(btn => {
                    btn.classList.remove('border-orange-500', 'bg-orange-50', 'dark:bg-stone-700', 'text-orange-600', 'dark:text-orange-400');
                    btn.classList.add('border-stone-100', 'dark:border-stone-700', 'text-stone-600', 'dark:text-stone-300');
                    const checkIcon = btn.querySelector('.sub-check-icon');
                    if (checkIcon) checkIcon.classList.add('hidden');
                });
            }
            
            // UPDATE STATE GLOBAL
            ACTIVE_FILTER = category;
            localStorage.setItem('activeFilterCategory', category);
            
            // Tutup mega menu jika terbuka
            const menu = document.getElementById('mega-menu');
            if (menu && !menu.classList.contains('hidden')) {
                menu.classList.add('hidden');
            }

            currentPage = 1;
            renderProducts(category);
            
            // Dapatkan semua tombol
            const allBtn = document.querySelector('button[data-category="All"]');
            const customBtn = document.querySelector('button[data-category="Request Design"]');
            const latestBtn = document.querySelector('button[data-category="Latest"]');
            const megaBtn = document.getElementById('mega-menu-btn');
            
            // RESET SEMUA TOMBOL DULU
            clearAllActiveStates();
            
            // AKTIFKAN HANYA TARGET
            let targetBtn = null;
            let targetCategory = category;
            
            if (category === 'All') targetBtn = allBtn;
            else if (category === 'Request Design') targetBtn = customBtn;
            else if (category === 'Latest') targetBtn = latestBtn;
            else {
                targetBtn = megaBtn;
                targetCategory = 'mega';
            }
            
            if (targetBtn) {
                setButtonActive(targetBtn, true, targetCategory === 'mega');
            }
            
            // Update state tracking
            activeFilterState.currentCategory = targetCategory;
            activeFilterState.isLocked = true;
            
            lucide.createIcons();
        }

        // RESET BUTTON - HANYA RESET NON-ACTIVE (OPTIMIZED)
        function resetBtnForSearch(btn) {
            if (!btn) return;
            
            // JANGAN reset jika tombol ini sedang aktif
            const currentActive = getActiveButton();
            if (currentActive && currentActive.btn === btn) {
                return; // Skip - jangan reset tombol aktif
            }
            
            // Reset hanya tombol non-aktif
            setButtonActive(btn, false, btn.id === 'mega-menu-btn');
        }
        
        // NEW: Helper function to get currently active button
        function getActiveButton() {
            const allBtn = document.querySelector('button[data-category="All"]');
            const customBtn = document.querySelector('button[data-category="Request Design"]');
            const latestBtn = document.querySelector('button[data-category="Latest"]');
            const megaBtn = document.getElementById('mega-menu-btn');
            
            if (allBtn && allBtn.classList.contains('bg-wood-dark')) return allBtn;
            if (customBtn && customBtn.classList.contains('bg-wood-dark')) return customBtn;
            if (latestBtn && latestBtn.classList.contains('bg-wood-dark')) return latestBtn;
            if (megaBtn && megaBtn.classList.contains('bg-wood-dark')) return megaBtn;
            
            return null;
        }

        // Hide Search Container on Mouse Leave if Empty
        function hideSearchIfEmpty() {
            const container = document.getElementById('search-container');
            const input = document.getElementById('search-input');
            
            // Only hide if the input is empty to avoid annoying the user while thinking
            if (input.value.trim() === '') {
                container.classList.add('hidden');
            }
        }

        // Search Toggle
        function toggleSearch() {
            const container = document.getElementById('search-container');
            const input = document.getElementById('search-input');
            if (container.classList.contains('hidden')) {
                container.classList.remove('hidden');
                input.focus();
            } else {
                container.classList.add('hidden');
            }
        }

        // Search Logic
        function searchProducts(query) {
            console.log('=== searchProducts START ===');
            console.log('query:', query);
            console.trace('searchProducts called from:');
            
            const grid = document.getElementById('product-grid');
            const lowerQuery = query.toLowerCase();
            
            // Removed auto-scroll to catalog when typing starts

            // Filter products by query (Keyword matching)
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(lowerQuery) || 
                p.desc.toLowerCase().includes(lowerQuery) ||
                p.category.toLowerCase().includes(lowerQuery) ||
                (p.keywords && p.keywords.some(k => k.toLowerCase().includes(lowerQuery)))
            );
            
            // Update UI
            const paginationContainer = document.getElementById('pagination-container');
            if (query.trim() === '') {
                renderProducts('All');
                return;
            }

            // Hide pagination during search
            if (paginationContainer) DOMUtils.safeSetHTML(paginationContainer, '');

            // Use safe DOM manipulation for search results
            grid.innerHTML = '';
            
            if (filtered.length === 0) {
                const noResults = document.createElement('div');
                noResults.className = 'col-span-full text-center text-stone-500 py-10';
                noResults.textContent = `Tidak ada produk yang cocok dengan "${query}"`;
                grid.appendChild(noResults);
            } else {
                filtered.forEach((product, index) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'product-card';
                    DOMUtils.safeSetHTML(cardElement, createProductCard(product, index));
                    grid.appendChild(cardElement);
                });
            }
            lucide.createIcons();
            
            // Show search results by ensuring grid is visible
            const catalogSection = document.getElementById('catalog-section');
            if (catalogSection && catalogSection.classList.contains('hidden')) {
                catalogSection.classList.remove('hidden');
            }
            
            // Reset filter buttons style to indicate search mode
            const resetBtnForSearchMode = (btn) => {
                console.log('resetBtnForSearchMode called for button:', btn?.id || btn?.getAttribute('data-category'));
                if(btn) {
                    btn.classList.remove('bg-wood-dark', 'text-white', 'shadow-md', 'border-orange-500', 'text-orange-600', 'ring-2', 'ring-orange-100');
                    btn.classList.add('bg-stone-50', 'text-stone-700', 'border', 'border-stone-200', 'hover:border-wood-medium', 'hover:text-wood-dark', 'dark:bg-stone-800', 'dark:text-stone-300', 'dark:border-stone-700', 'dark:hover:border-wood-light', 'dark:hover:text-wood-light');
                     if(btn.id === 'mega-menu-btn') {
                         // Only reset to default text if no subcategory is selected
                         if (!tempSelectedCategory || !tempSelectedCategory.label) {
                             updateKategoriButton('default', 'Kategori Produk');
                         }
                         // If a subcategory IS selected, do NOT reset the text - preserve the current label
                         
                         // Remove X button wrapper if exists
                         const resetWrapper = btn.querySelector('.js-reset-mega-menu');
                         if (resetWrapper) {
                             resetWrapper.remove();
                         }

                         // Remove any direct icon children except X icon
                         Array.from(btn.children).forEach(child => {
                             if ((child.tagName === 'I' || child.tagName === 'SVG') && 
                                 child.getAttribute('data-lucide') !== 'x') {
                                 child.remove();
                             }
                         });
                    }
                }
            };

            const allBtn = document.querySelector('button[data-category="All"]');
            const customBtn = document.querySelector('button[data-category="Request Design"]');
            const latestBtn = document.querySelector('button[data-category="Latest"]');
            const megaBtn = document.getElementById('mega-menu-btn');
            
            resetBtnForSearchMode(allBtn);
            resetBtnForSearchMode(customBtn);
            resetBtnForSearchMode(latestBtn);
            resetBtnForSearchMode(megaBtn);
        }

        // Persist scroll position before navigating to product detail or information pages
        document.addEventListener('click', (e) => {
            const anchor = e.target.closest('a[href^="product.html"]');
            const infoAnchor = e.target.closest('a[href="./cara-pemesanan.html"], a[href="./garansi.html"], a[href="./tentang-kami.html"], a[href="./pengiriman.html"]');
            
            if (anchor) {
                try {
                    sessionStorage.setItem('indexScrollY', String(window.scrollY));
                    sessionStorage.setItem('fromProduct', '1');
                } catch (_) {}
            } else if (infoAnchor) {
                // Save scroll position for information pages (cara-pemesanan, garansi, etc.)
                try {
                    sessionStorage.setItem('indexScrollY', String(window.scrollY));
                    sessionStorage.setItem('fromInfoPage', '1');
                } catch (_) {}
            }
        });

        // Handle chevron click - separate function for better event management


        // Initial Render - Immediate execution
        (function() {
            renderProducts(currentCategory);
            // Render mega menu structure immediately to prevent delay
            renderMegaMenuStructure();
            isMegaMenuRendered = true;
            // Initialize icons immediately
            lucide.createIcons();
        })();
        
        document.addEventListener('DOMContentLoaded', function() {
            // Restore scroll position when returning from product or information page
            try {
                const fromProduct = sessionStorage.getItem('fromProduct') === '1';
                const fromInfoPage = sessionStorage.getItem('fromInfoPage') === '1';
                const savedY = parseInt(sessionStorage.getItem('indexScrollY') || '', 10);
                if ((fromProduct || fromInfoPage) && !Number.isNaN(savedY)) {
                    if (location.hash) {
                        history.replaceState(null, '', location.pathname + location.search);
                    }
                    // Restore to the saved scroll position
                    requestAnimationFrame(() => {
                        window.scrollTo(0, savedY);
                    });
                    sessionStorage.removeItem('fromProduct');
                    sessionStorage.removeItem('fromInfoPage');
                    sessionStorage.removeItem('indexScrollY');
                }
            } catch (_) {}
        });

        // Restore Mega Menu State if currentCategory is from mega menu
        setTimeout(() => {
            if (currentCategory && !['All', 'Latest', 'Request Design'].includes(currentCategory)) {
                // Find the category in megaMenuCategories
                let foundCategory = null;
                let foundSubcategory = null;
                
                for (const cat of megaMenuCategories) {
                    const subcat = cat.subcategories.find(sub => sub.value === currentCategory);
                    if (subcat) {
                        foundCategory = cat;
                        foundSubcategory = subcat;
                        break;
                    }
                }
                
                if (foundCategory && foundSubcategory) {
                    // Update mega menu button text and activate it
                    const megaBtn = document.getElementById('mega-menu-btn');
                    
                    // Use unified render function for consistent UI - this handles both text and X icon positioning
                    updateKategoriButton('selected', foundSubcategory.name);
                    
                    // Activate mega menu button styling
                    setButtonActive(megaBtn, true, true);
                    
                    // Deactivate other buttons
                    const allBtn = document.querySelector('button[data-category="All"]');
                    const customBtn = document.querySelector('button[data-category="Request Design"]');
                    const latestBtn = document.querySelector('button[data-category="Latest"]');
                    
                    setButtonActive(allBtn, false);
                    setButtonActive(customBtn, false);
                    setButtonActive(latestBtn, false);
                    
                    console.log(' Used unified renderActiveCategory for:', foundSubcategory.name);
                    console.log(' Mega button structure after unified render:', Array.from(megaBtn.children).map(child => child.tagName + '.' + child.className));
                }
            }
        }, 100); // Small delay to ensure DOM is ready

        // INISIALISASI - PRIORITAS localStorage (FINAL)
        function initializeFilterState() {
            activeFilterState.isInitializing = true;
            
            // Prioritas: localStorage > sessionStorage > default
            const savedCategory = localStorage.getItem('activeFilterCategory');
            const categoryToRestore = savedCategory || sessionStorage.getItem('currentCategory') || 'All';
            
            // Dapatkan tombol yang sesuai
            const buttons = {
                'All': document.querySelector('button[data-category="All"]'),
                'Request Design': document.querySelector('button[data-category="Request Design"]'),
                'Latest': document.querySelector('button[data-category="Latest"]'),
                'mega': document.getElementById('mega-menu-btn')
            };
            
            // Reset semua tombol (kecuali yang akan diaktifkan)
            Object.entries(buttons).forEach(([cat, btn]) => {
                if (btn && cat !== (categoryToRestore === 'mega' ? 'mega' : categoryToRestore)) {
                    setButtonActive(btn, false, cat === 'mega');
                }
            });
            
            // Aktifkan tombol yang sesuai
            const targetBtn = buttons[categoryToRestore] || buttons['All'];
            const targetCategory = categoryToRestore === 'mega' ? 'mega' : categoryToRestore;
            
            if (targetBtn) {
                setSingleActiveButton(targetBtn, targetCategory);
            }
            
            // Update currentCategory jika perlu
            if (savedCategory && savedCategory !== (sessionStorage.getItem('currentCategory') || 'All')) {
                sessionStorage.setItem('currentCategory', savedCategory);
            }
            
            // RESTORE SAVED SUBCATEGORY FROM localStorage - CRITICAL FOR CONSISTENCY
            const savedSubCategory = localStorage.getItem('selectedSubCategory');
            if (savedSubCategory) {
                try {
                    const parsed = JSON.parse(savedSubCategory);
                    if (parsed && parsed.label) {
                        tempSelectedCategory = parsed;
                        // Use unified render function for consistent UI
                        updateKategoriButton('selected', parsed.label);
                    }
                } catch (e) {
                    console.warn('Failed to parse saved subcategory:', e);
                }
            }
            
            // Selesai inisialisasi
            activeFilterState.isInitializing = false;
        }

        // Event listener untuk filter buttons - FINAL ANTI-CONFLICT
        document.addEventListener('DOMContentLoaded', function() {
            // 0. SETUP AWAL - Pastikan state kategori terapply dengan benar
            const megaBtn = document.getElementById('mega-menu-btn');
            if (megaBtn) {
                // Cek apakah ada kategori tersimpan di localStorage
                const savedSubCategory = localStorage.getItem('selectedSubCategory');
                if (savedSubCategory) {
                    try {
                        const parsed = JSON.parse(savedSubCategory);
                        if (parsed && parsed.label) {
                            // Jika ada kategori tersimpan, update ACTIVE_FILTER dan apply state
                            ACTIVE_FILTER = 'mega';
                            updateKategoriButton('selected', parsed.label);
                        }
                    } catch (e) {
                        console.warn('Failed to parse saved subcategory on load:', e);
                    }
                }
            }
            
            // 1. HAPUS SEMUA ACTIVE CLASS DULU (BERSIH-BERSIH)
            clearAllActiveStates();
            
            // 2. SET ACTIVE FILTER BERDASARKAN STATE GLOBAL
            const buttons = {
                'All': document.querySelector('button[data-category="All"]'),
                'Request Design': document.querySelector('button[data-category="Request Design"]'),
                'Latest': document.querySelector('button[data-category="Latest"]'),
                'mega': document.getElementById('mega-menu-btn')
            };
            
            const targetBtn = buttons[ACTIVE_FILTER] || buttons['All'];
            if (targetBtn) {
                setButtonActive(targetBtn, true, ACTIVE_FILTER === 'mega');
            }
            
            // 3. UPDATE STATE
            activeFilterState.currentCategory = ACTIVE_FILTER;
            activeFilterState.isLocked = true;
            activeFilterState.isInitializing = false;
            
            // Setup event listeners untuk filter buttons
            const allBtn = document.querySelector('button[data-category="All"]');
            const customBtn = document.querySelector('button[data-category="Request Design"]');
            const latestBtn = document.querySelector('button[data-category="Latest"]');
            const megaBtnEventListener = document.getElementById('mega-menu-btn');
            
            if (allBtn) allBtn.addEventListener('click', () => filterProducts('All'));
            if (customBtn) customBtn.addEventListener('click', () => filterProducts('Request Design'));
            if (latestBtn) allBtn.addEventListener('click', () => filterProducts('Latest'));
            
            // FINAL CHECK: Update UI jika ada kategori aktif
            const savedSubCategory = localStorage.getItem('selectedSubCategory');
            if (savedSubCategory) {
                try {
                    const parsed = JSON.parse(savedSubCategory);
                    if (parsed && parsed.label) {
                        const iconX = document.querySelector('#icon-x');
                        const kategoriLabel = document.querySelector('#kategori-label');
                        
                        if (iconX && kategoriLabel) {
                            iconX.classList.remove('hidden');
                            kategoriLabel.textContent = parsed.label;
                            console.log(' FINAL CHECK: X shown, label updated to:', parsed.label);
                        }
                    }
                } catch (e) {
                    console.warn('Final check failed:', e);
                }
            }
            
            // Setup proper event listener for mega menu X icon click
            console.log(' Setting up event listeners for mega button:', megaBtnEventListener);
            
            if (history.scrollRestoration) {
                history.scrollRestoration = 'auto';
            }
            
            if (megaBtnEventListener) {
                // Log initial state
                console.log(' Initial button children:', Array.from(megaBtnEventListener.children).map(child => child.tagName + '.' + child.className));
                
                // Setup mutation observer to detect lucide icon changes
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList') {
                            mutation.addedNodes.forEach(function(node) {
                                if (node.nodeType === 1 && (node.tagName === 'svg' || node.tagName === 'path')) {
                                    console.log(' Lucide icon change detected:', node.tagName);
                                    
                                    // Re-attach event listeners for new icons
                                    setTimeout(() => {
                                        // Check for new X icon
                                        const newXicon = megaBtn.querySelector('[data-lucide="x"], svg[data-lucide="x"]');
                                        if (newXicon) {
                                            console.log(' Re-attaching to new X icon after lucide change');
                                            newXicon.addEventListener('click', function(e) {
                                                console.log(' X icon clicked after lucide change!');
                                                e.preventDefault();
                                                e.stopPropagation();
                                                resetMegaMenu();
                                            });
                                        }
                                    }, 10);
                                }
                            });
                        }
                    });
                });
                
                // Start observing the mega button for changes
                observer.observe(megaBtn, {
                    childList: true,
                    subtree: true
                });
                
                console.log(' Mutation observer started for lucide icon changes');
                
                // MAIN event listener - comprehensive click detection
                megaBtn.addEventListener('click', function(e) {
                    console.log(' Click detected on mega button!');
                    
                    // DETECT X ICON CLICKS - Priority 1
                    const isXicon = (
                        e.target.closest('.js-reset-mega-menu') ||
                        e.target.closest('[data-lucide="x"]') ||
                        e.target.closest('svg[data-lucide="x"]') ||
                        (e.target.tagName === 'path' && e.target.closest('svg[data-lucide="x"]')) ||
                        (e.target.tagName === 'svg' && e.target.getAttribute('data-lucide') === 'x')
                    );
                    
                    if (isXicon) {
                        console.log(' X ICON DETECTED - Resetting mega menu!');
                        e.preventDefault();
                        e.stopPropagation();
                        resetMegaMenu();
                        return;
                    }
                    
                    // Regular button click - open menu
                    console.log(' Regular mega menu click - opening menu');
                    toggleMegaMenu(e);
                });
            }
        });

        // Event Listeners for refactored buttons
        document.addEventListener('DOMContentLoaded', function() {
            // Search toggle button
            const searchToggleBtn = document.getElementById('search-toggle-btn');
            if (searchToggleBtn) {
                searchToggleBtn.addEventListener('click', toggleSearch);
            }
            
            // Filter buttons
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    filterProducts(category);
                });
            });
            
            // Mega menu toggle button
            const megaMenuToggleBtn = document.getElementById('mega-menu-mobile-toggle');
            if (megaMenuToggleBtn) {
                megaMenuToggleBtn.addEventListener('click', toggleMegaMenu);
            }
            
            // Mega menu select button
            const megaMenuSelectBtn = document.getElementById('mega-menu-select-btn');
            if (megaMenuSelectBtn) {
                megaMenuSelectBtn.addEventListener('click', applyMegaMenuSelection);
            }
            
            // Modal close buttons
            const aboutCloseBtn = document.querySelector('#about-overlay button[onclick="closeAbout()"]');
            if (aboutCloseBtn) {
                aboutCloseBtn.removeAttribute('onclick');
                aboutCloseBtn.addEventListener('click', closeAbout);
            }
            
            const warrantyCloseBtn = document.querySelector('#warranty-overlay button[onclick="closeWarranty()"]');
            if (warrantyCloseBtn) {
                warrantyCloseBtn.removeAttribute('onclick');
                warrantyCloseBtn.addEventListener('click', closeWarranty);
            }
            
            const shippingCloseBtn = document.querySelector('#shipping-overlay button[onclick="closeShipping()"]');
            if (shippingCloseBtn) {
                shippingCloseBtn.removeAttribute('onclick');
                shippingCloseBtn.addEventListener('click', closeShipping);
            }
            
            // Overlay click to close modals
            const aboutOverlay = document.getElementById('about-overlay');
            if (aboutOverlay) {
                aboutOverlay.removeAttribute('onclick');
                aboutOverlay.addEventListener('click', function(e) {
                    if (e.target === this) closeAbout();
                });
            }
            
            const warrantyOverlay = document.getElementById('warranty-overlay');
            if (warrantyOverlay) {
                warrantyOverlay.removeAttribute('onclick');
                warrantyOverlay.addEventListener('click', function(e) {
                    if (e.target === this) closeWarranty();
                });
            }
            
            const shippingOverlay = document.getElementById('shipping-overlay');
            if (shippingOverlay) {
                shippingOverlay.removeAttribute('onclick');
                shippingOverlay.addEventListener('click', function(e) {
                    if (e.target === this) closeShipping();
                });
            }
            
            // Logo link
            const logoLink = document.querySelector('a[onclick="resetWebState(event)"]');
            if (logoLink) {
                logoLink.removeAttribute('onclick');
                logoLink.addEventListener('click', function(e) {
                    resetWebState(e);
                });
            }
            
            // FINAL CHECK: Update UI jika ada kategori aktif
            const savedSubCategory = localStorage.getItem('selectedSubCategory');
            if (savedSubCategory) {
                try {
                    const parsed = JSON.parse(savedSubCategory);
                    if (parsed && parsed.label) {
                        const iconX = document.querySelector('#icon-x');
                        const kategoriLabel = document.querySelector('#kategori-label');
                        
                        if (iconX && kategoriLabel) {
                            iconX.classList.remove('hidden');
                            kategoriLabel.textContent = parsed.label;
                            console.log(' FINAL CHECK: X shown, label updated to:', parsed.label);
                        }
                    }
                } catch (e) {
                    console.warn('Final check failed:', e);
                }
            }
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered:', registration);
                    })
                    .catch(error => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
    </script>
    
    <!-- Lazy Loading for Images -->
    <script>
        // Initialize lazy loading when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                if (window.PerformanceUtils) {
                    PerformanceUtils.lazyLoadImages('img[loading="lazy"]');
                }
            });
        } else {
            if (window.PerformanceUtils) {
                PerformanceUtils.lazyLoadImages('img[loading="lazy"]');
            }
        }
    </script>
</body>
</html>
